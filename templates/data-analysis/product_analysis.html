<div class="container">
    <h1>Amazon Product Analysis
        <br>产品分析
    </h1>
    <form id="analysis-form" action="{{ url_for('dataset.product_analysis.product_analysis') }}" method="POST" enctype="multipart/form-data">
        <label for="project_name">项目名称:</label>
        <select name="project_name" id="project_name" required>
            <option value="">请选择项目</option>
            {% for project in projects %}
            <option value="{{ project }}">{{ project }}</option>
            {% endfor %}
        </select>

        <label for="report_date_range">报表日期范围:</label>
        <div class="date-range-container">
            <input type="date" name="report_start_date" id="report_start_date" required>
            <span>至</span>
            <input type="date" name="report_end_date" id="report_end_date" required>
            <button type="button" id="last-week-btn">上周</button>
        </div>

        <!-- 简化的拖拽文件上传区域 -->
        <div class="drop-area" id="drop-area">
            <h3>拖拽文件到此处</h3>
            <p>或点击选择文件</p>
            <p class="file-types">支持文件类型：.csv, .xlsx</p>
            <p class="upload-hint">可以分次上传，每次上传1个或多个文件</p>
            <input type="file" id="file-input" name="files" multiple accept=".csv,.xlsx" style="display: none;">
        </div>

        <!-- 文件列表显示 -->
        <div class="file-list" id="file-list">
            <div class="file-item empty" id="file-business_report">
                <span>业务报告：等待上传（.csv格式）
                    <a href="{{ url_for('help.business_report') }}" target="_blank" class="help-icon">?</a>
                </span>
                <span class="upload-progress">未上传</span>
            </div>
            <div class="file-item empty" id="file-payment_report">
                <span>付款报告：等待上传（.csv格式）
                    <a href="{{ url_for('help.payment_report') }}" target="_blank" class="help-icon">?</a>
                </span>
                <span class="upload-progress">未上传</span>
            </div>
            <div class="file-item empty" id="file-ad_product_report">
                <span>广告报表：等待上传（.xlsx格式）
                    <a href="{{ url_for('help.ad_product_report') }}" target="_blank" class="help-icon">?</a>
                </span>
                <span class="upload-progress">未上传</span>
            </div>
        </div>

        <!-- 隐藏的文件路径输入框 -->
        <div class="hidden-inputs">
            <input type="hidden" name="business_report_path" id="business_report_path">
            <input type="hidden" name="payment_report_path" id="payment_report_path">
            <input type="hidden" name="ad_product_report_path" id="ad_product_report_path">
        </div>

        <button type="submit" id="submit-btn" disabled>生成产品分析</button>
    </form>
</div>

<style>
    .drop-area {
        border: 2px dashed rgba(0, 212, 255, 0.3);
        border-radius: 10px;
        padding: 30px;
        text-align: center;
        margin: 20px 0;
        transition: all 0.3s ease;
        background: rgba(255, 255, 255, 0.05);
        position: relative;
        cursor: pointer;
    }
    
    .drop-area:hover, .drop-area.dragover {
        border-color: var(--neon-blue);
        background: rgba(0, 212, 255, 0.1);
    }
    
    .drop-area.uploading {
        background: rgba(0, 255, 136, 0.1);
        border-color: var(--success-color);
    }
    
    .drop-area h3 {
        color: var(--text-primary);
        margin-bottom: 10px;
    }
    
    .drop-area p {
        margin: 10px 0;
        color: var(--text-secondary);
    }
    
    .file-types {
        font-size: 0.9em;
        color: var(--text-muted);
        margin-top: 5px;
    }
    
    .upload-hint {
        font-size: 0.85em;
        color: var(--text-muted);
        margin-top: 10px;
        font-style: italic;
    }
    
    .file-list {
        margin-top: 20px;
    }
    
    .file-item {
        padding: 12px;
        margin: 8px 0;
        background: rgba(255, 255, 255, 0.05);
        border-radius: 8px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        border: 1px solid rgba(0, 212, 255, 0.1);
        position: relative;
    }
    
    .file-item.empty {
        background: rgba(255, 255, 255, 0.02);
        border: 1px dashed rgba(255, 255, 255, 0.1);
        color: var(--text-muted);
        font-style: italic;
    }
    
    .file-item.uploaded {
        background: rgba(0, 255, 136, 0.1);
        border-left: 4px solid var(--success-color);
    }
    
    .file-item.uploading {
        background: rgba(255, 170, 0, 0.1);
        border-left: 4px solid var(--warning-color);
    }
    
    .file-item.error {
        background: rgba(255, 0, 110, 0.1);
        border-left: 4px solid var(--error-color);
    }
    
    .file-item span:first-child {
        color: var(--text-primary);
    }
    
    .upload-progress {
        font-size: 0.8em;
        color: var(--text-secondary);
    }
    
    .remove-file {
        background: var(--error-color);
        color: white;
        border: none;
        border-radius: 3px;
        padding: 2px 6px;
        cursor: pointer;
        font-size: 0.8em;
        margin-left: 10px;
    }
    
    .remove-file:hover {
        background: #cc0055;
    }
    
    .hidden-inputs {
        display: none;
    }
    
    .date-range-container {
        display: flex;
        gap: 10px;
        align-items: center;
        margin-top: 8px;
    }
    
    .date-range-container input[type="date"] {
        flex: 1;
    }
    
    .date-range-container span {
        color: var(--text-primary);
    }
    
    </style>
