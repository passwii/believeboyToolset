# IFLOW.md - 彼励扶工具集 项目背景与指令指南

## 项目概述

**彼励扶工具集** 是一个基于 Flask 的 Web 应用程序，专为电商数据分析和管理而设计。项目名称体现了其核心理念：用心流（iFlow）的理念帮助用户相信并扶助他们的商业成功。

### 项目定位
- **目标用户**: 电商从业者、数据分析师、运营管理者
- **核心价值**: 提供一站式的数据分析、店铺管理和业务洞察工具
- **业务场景**: 亚马逊电商分析、竞品监控、产品数据处理、财务报表生成

## 技术架构

### 核心技术栈
- **后端框架**: Flask (Python 3.12+)
- **数据库**: SQLite3
- **数据处理**: pandas, numpy
- **Excel处理**: openpyxl
- **前端技术**: HTML5, CSS3, JavaScript
- **UI框架**: Bootstrap CSS + Material Design 原则

### 系统特性
- **认证系统**: 基于 Flask Session 的用户认证
- **权限管理**: 管理员/普通用户权限分离
- **日志系统**: 完整的用户操作和系统日志记录
- **数据安全**: 北京时区支持，密码哈希加密
- **文件处理**: 支持 CSV/Excel 文件上传和分析

## 项目结构详解

```
/Users/damon/PycharmProjects/believeboyToolset/
├── app.py                    # 应用入口文件
├── requirements.txt          # Python依赖列表 (当前为空)
├── users.db                  # SQLite数据库文件
├── core/                     # 核心业务逻辑
│   ├── config.py             # 系统配置
│   ├── database.py           # 数据库操作
│   ├── auth.py               # 认证模块
│   ├── user_model.py         # 用户模型
│   ├── shop_model.py         # 店铺模型
│   ├── log_service.py        # 日志服务
│   └── statistics_service.py # 统计服务
├── routes/                   # 路由定义
│   ├── toolset.py            # 工具集路由
│   ├── dataset.py            # 数据分析路由
│   ├── admin.py              # 管理员路由
│   └── help.py               # 帮助页面路由
├── apps/                     # 应用功能模块
│   ├── product_analysis.py   # 产品分析功能
│   ├── daily_report.py       # 日报生成
│   └── model_file/           # 模型文件
├── templates/                # HTML模板
├── static/                   # 静态资源
│   ├── css/                  # 样式文件
│   ├── js/                   # JavaScript文件
│   └── images/               # 图片资源
├── project/                  # 项目数据目录
│   ├── 宝勒/                 # 宝勒项目数据
│   ├── 宝勒1店/              # 宝勒1店数据
│   ├── 宝勒2店/              # 宝勒2店数据
│   ├── 华洋/                 # 华洋项目数据
│   └── 铨富/                 # 铨富项目数据
└── app/db_init/              # 数据库初始化工具
```

## 主要功能模块

### 1. 用户认证与权限管理
- **登录系统**: 支持用户名/密码登录
- **权限分离**: 管理员 (damonrock) 和普通用户
- **会话管理**: 5小时会话超时
- **密码安全**: SHA256 哈希加密

### 2. 店铺管理
- **店铺类型**: 自有店铺和竞品店铺
- **权限控制**: 根据用户中文名称匹配店铺权限
- **信息管理**: 店铺名称、品牌、URL、操作员管理

### 3. 产品数据分析
- **数据源支持**:
  - 业务报告 (CSV)
  - 付款报告 (CSV) 
  - 广告报表 (Excel)
- **分析维度**:
  - 销售数据 (销量、销售额、转化率)
  - 广告数据 (展示量、点击量、花费、ACOS、CPC)
  - 成本分析 (FOB成本、头程费用、平台佣金、FBA配送费)
  - 利润计算 (总成本、利润率、退款率)
- **FBM支持**: 特殊支持"宝勒"项目的FBM费用计算
- **输出格式**: Excel格式的分析报告

### 4. 工具集功能
- **汇率转换**: 实时汇率查询和转换
- **图片处理**: 图片尺寸调整工具
- **Amazon爬虫**: 产品信息爬取功能
- **调研分析**: Excel文件上传和分析

### 5. 日志系统
- **日志类型**: 用户操作、系统事件、安全日志
- **记录内容**: 用户ID、操作类型、资源、IP地址、用户代理
- **日志级别**: debug, info, warning, error, critical
- **自动清理**: 30天前的旧日志自动清理

## 运行与部署

### 环境要求
- Python 3.12+
- SQLite3
- 现代浏览器支持

### 安装步骤
1. **依赖安装**: `pip install -r requirements.txt`
2. **运行应用**: `python app.py`
3. **访问地址**: http://localhost:8800

### 默认账户
- **管理员账户**: 用户名 `admin`，密码 `admin123`
- **普通用户**: 用户名 `user`，密码 `user123`
- **管理员权限**: 用户名 `damonrock` (特殊权限)

### 配置说明
- **主机地址**: 0.0.0.0 (允许外部访问)
- **端口**: 8800
- **调试模式**: True (开发环境)
- **会话超时**: 5小时 (18000秒)

## 开发指南

### 添加新功能的步骤
1. **创建路由**: 在 `routes/` 目录下创建新的路由文件
2. **创建模板**: 在 `templates/` 目录下添加对应的HTML模板
3. **静态资源**: 在 `static/` 目录下添加CSS/JS文件
4. **蓝图注册**: 在 `routes/__init__.py` 中注册新的蓝图
5. **日志集成**: 使用 LogService 记录关键操作

### 数据库操作
- **连接获取**: 使用 `get_db_connection()` 函数
- **模型设计**: 参考 `core/user_model.py` 和 `core/shop_model.py`
- **事务处理**: 重要操作使用 try-finally 确保资源释放

### 前端开发
- **样式系统**: 使用Bootstrap CSS框架
- **组件化**: 建议使用 `static/js/components/` 目录
- **响应式设计**: 确保在不同设备上的兼容性
- **用户交互**: 统一的错误处理和用户反馈

### 测试规范
- **功能测试**: 在 `tests/` 目录下添加测试文件
- **权限测试**: 验证用户权限控制逻辑
- **数据完整性**: 确保数据分析结果的准确性

## 数据流程

### 产品分析数据流
1. **文件上传**: 用户上传3个必需文件 (业务报告、付款报告、广告报表)
2. **数据清洗**: pandas处理和格式化数据
3. **关联计算**: SKU-ASIN映射，成本利润计算
4. **指标生成**: 转化率、ACOS、利润率等关键指标
5. **报告输出**: 生成Excel格式的分析报告

### 权限控制流程
1. **用户登录**: 验证用户名密码，创建会话
2. **权限检查**: 装饰器检查登录状态和用户权限
3. **数据过滤**: 根据用户权限过滤可见数据
4. **操作记录**: 所有关键操作记录到日志系统

## 注意事项

### 安全建议
1. **生产环境**: 必须修改默认 SECRET_KEY
2. **密码策略**: 强制用户使用强密码
3. **HTTPS配置**: 生产环境启用HTTPS
4. **访问控制**: 配置防火墙和访问限制

### 性能优化
1. **数据库索引**: 为频繁查询的字段添加索引
2. **文件处理**: 大文件上传使用流式处理
3. **缓存机制**: 统计数据使用缓存
4. **并发处理**: 避免长时间阻塞操作

### 维护建议
1. **日志监控**: 定期检查系统日志
2. **数据备份**: 定期备份users.db数据库
3. **依赖更新**: 定期更新Python依赖包
4. **版本控制**: 使用git管理代码变更

## 联系信息
- **项目地址**: https://github.com/passwii/believeboyToolset.git
- **开发者**: Damon (damonrock)
- **最后更新**: 2025年11月1日

---
*此文档基于项目当前状态生成，如有变更请及时更新。*